{"version":3,"file":"install-app-deps.js","sourceRoot":"","sources":["../../src/cli/install-app-deps.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AA4BA,AAAgB,AAChB,AAAM;;oEAAC,AAAK,WAAyB,AAAS;AAC5C,YAAI,AAAC;AACH,AAAG,2EAAC,AAAmB,AAAG,AAAe,AAAC,AAC5C;AAAC,UACD,AAAK,AAAC,OAAC,AAAC,AAAC,GAAC,AAAC;AACT,AAAkC;AAClC,AAAE,AAAC,gBAAC,AAAC,EAAC,AAAC,aAAY,AAAc,AAAC,AAAC,iBAAC,AAAC;AACnC,sBAAM,AAAC,AACT;AAAC,AACH;AAAC;AAED,cAAM,AAAU,aAAG,AAAO,QAAC,AAAG,AAAE;AAChC,cAAM,AAAM,SAAG,CAAC,MAAM,AAAS,2CAAC,AAAU,YAAE,AAAI,MAAE,AAAI,MAAE,AAAI,AAAC,AAAC,UAAI,AAAE;AACpE,cAAM,AAAW,cAAG,AAAM,OAAC,AAAW;AACtC,cAAM,AAAO,UAAG,MAAM,AAAe,gDAAC,AAAG,2FACZ,AAAU,2EAAM,AAAM,OAAC,AAAW;AAAE,AAAE,mBAAI,AAAG,GAAC,AAAG,AAAC,AAAC;SAAvC,AAAG,CAA1C,AAA0B,CADsB,EAEhD,AAAW,eAAI,AAAI,OAAG,AAAkB,oDAAC,AAAM,QAAE,AAAU,AAAC,cAAG,AAAe,gDAAC,AAAO,QAAC,AAAW,AAAC,AACpG,AAAC;AAEF,AAAsG;AACtG,cAAM,AAAgB,8CAAC,AAAM,QAAE,AAAO,QAAC,AAAC,AAAC,IAAE,EAAC,AAAO,SAAE,AAAO,QAAC,AAAC,AAAC,IAAE,AAAa,eAAE,AAAW,eAAI,AAAI,AAAC,QAAE,AAAI,KAAC,AAAQ,UAAE,AAAI,KAAC,AAAI,MAAE,AAAO,QAAC,AAAC,AAAC,OAAK,AAAU,AAAC,AAC5J;AAAC;;;;;;;;;;;AA/CD,AAAO,AAAE,AAA0B,AAAE,AAAG,AAAE,AAAG,AAAE,AAAI,AAAE,AAAM,AAAuB;;;;;;AAClF,AAAO,AAAE,AAAiB,AAAE,AAAM,AAAmC;;;;;;AACrE,AAAO,AAAK,AAAM,AAAO;;;;;;AACzB,AAAO,AAAE,AAAS,AAAE,AAAkB,AAAE,AAAM,AAAgB;;;;;;AAC9D,AAAO,AAAE,AAAgB,AAAE,AAAM,AAAc;;;;;;AAI/C,AAAgB,AAChB,AAAM;wCAAyC,AAAkB;AAC/D,AAA4C;AAC5C,AAAqC;AACrC,AAAM,iBACH,AAAM,OAAC,AAAU;AAChB,AAAO,iBAAE,CAAC,AAAO,SAAE,AAAQ,UAAE,AAAO,AAAC;AACrC,AAAO,iBAAE,AAAO,QAAC,AAAQ;AACzB,AAAW,qBAAE,AAAqB,AACnC,AAAC;AAJkB,KADf,AAAK,EAMT,AAAM,OAAC,AAAM;AACZ,AAAO,iBAAE,CAAC,AAAM,QAAE,AAAK,OAAE,AAAK,AAAC;AAC/B,AAAO,iBAAE,AAAO,QAAC,AAAI;AACrB,AAAW,qBAAE,AAAiB,AAC/B,AAAC,AACN;AALoB;AAKnB;AA0BD;AACE,AAAM,WAAC,AAAc,eAAC,AAA8B,AAAC,AAAK,AAAC,kEAAC,AAAI,AAAC,AACnE;AAAC;AAED,AAAE,AAAC,IAAC,AAAO,QAAC,AAAU,eAAK,AAAM,AAAC,QAAC,AAAC;AAClC,AAAI,oEAAC,AAA6D,AAAC;AACnE,AAAI,AAAE,WACH,AAAK,AAAC,AAAiB,AAAC,AAC7B;AAAC","sourcesContent":["#! /usr/bin/env node\n\nimport BluebirdPromise from \"bluebird-lst\"\nimport { computeDefaultAppDirectory, log, use, warn } from \"electron-builder-util\"\nimport { printErrorAndExit } from \"electron-builder-util/out/promise\"\nimport yargs from \"yargs\"\nimport { getConfig, getElectronVersion } from \"../util/config\"\nimport { installOrRebuild } from \"../util/yarn\"\n\ndeclare const PACKAGE_VERSION: string\n\n/** @internal */\nexport function configureInstallAppDepsCommand(yargs: yargs.Yargs): yargs.Yargs {\n  // https://github.com/yargs/yargs/issues/760\n  // demandOption is required to be set\n  return yargs\n    .option(\"platform\", {\n      choices: [\"linux\", \"darwin\", \"win32\"],\n      default: process.platform,\n      description: \"The target platform\",\n    })\n    .option(\"arch\", {\n      choices: [\"ia32\", \"x64\", \"all\"],\n      default: process.arch,\n      description: \"The target arch\",\n    })\n}\n\n/** @internal */\nexport async function installAppDeps(args: any) {\n  try {\n    log(\"electron-builder \" + PACKAGE_VERSION)\n  }\n  catch (e) {\n    // error in dev mode without babel\n    if (!(e instanceof ReferenceError)) {\n      throw e\n    }\n  }\n\n  const projectDir = process.cwd()\n  const config = (await getConfig(projectDir, null, null, null)) || {}\n  const muonVersion = config.muonVersion\n  const results = await BluebirdPromise.all<string>([\n    computeDefaultAppDirectory(projectDir, use(config.directories, it => it!.app)),\n    muonVersion == null ? getElectronVersion(config, projectDir) : BluebirdPromise.resolve(muonVersion),\n  ])\n\n  // if two package.json â€” force full install (user wants to install/update app deps in addition to dev)\n  await installOrRebuild(config, results[0], {version: results[1], useCustomDist: muonVersion == null}, args.platform, args.arch, results[0] !== projectDir)\n}\n\nfunction main() {\n  return installAppDeps(configureInstallAppDepsCommand(yargs).argv)\n}\n\nif (process.mainModule === module) {\n  warn(\"Please use as subcommand: electron-builder install-app-deps\")\n  main()\n    .catch(printErrorAndExit)\n}"]}
